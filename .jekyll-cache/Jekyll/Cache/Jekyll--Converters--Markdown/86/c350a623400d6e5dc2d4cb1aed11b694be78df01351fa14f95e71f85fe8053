I"ß<h1 id="ä¸ºä»€ä¹ˆä½¿ç”¨-filebeat">ä¸ºä»€ä¹ˆä½¿ç”¨ Filebeat</h1>

<p>Logstash æ˜¯ä¸€ä¸ª Java ç¨‹åºï¼Œå½“ä½œä¸ºæ”¶é›†æ—¥å¿—çš„ Agent æ—¶ï¼Œæ˜¾å¾—å¤ªè‡ƒè‚¿äº†ã€‚<br />
ä¹‹å‰å¬è¿‡ä¸€ä¸ªå…¬å¸(æ–—é±¼)ä½¿ç”¨ Logstash ä½œä¸ºæ—¥å¿—æ”¶é›† Agent æ—¶ï¼Œèµ„æºå ç”¨å¥½åƒæ¯”ä¸šåŠ¡è¿›ç¨‹å ç”¨è¿˜å¤šï¼ Â 
è¿™æ—¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè½»é‡çº§çš„æ—¥å¿—æ”¶é›† Agentï¼Œä¸Šé¢è¯´çš„é‚£å®¶å…¬å¸çš„å¤„ç†æ–¹æ³•æ˜¯è‡ªå·±å†™äº†ä¸€ä¸ª Agentã€‚<br />
å…¶å®æˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹å®˜æ–¹æ˜¯å¦æä¾›ç›¸å…³çš„ Agentï¼Œç°åœ¨æˆ‘çš„éœ€æ±‚æ˜¯æ”¶é›†ç‰¹å®šçš„æ—¥å¿—æ–‡ä»¶ï¼Œ
å®˜æ–¹æä¾›äº†è¿™æ ·çš„å·¥å…·ï¼šFilebeatï¼Œå®˜æ–¹ç»™ Filebeat çš„å®šä¹‰å°±æ˜¯è½»é‡çº§çš„æ—¥å¿—æ”¶é›†å·¥å…·ã€‚</p>

<pre>

Filebeat æ˜¯åŸºäºåŸå…ˆ logstash-forwarder çš„æºç æ”¹é€ å‡ºæ¥çš„ã€‚
æ¢å¥è¯è¯´ï¼šFilebeat å°±æ˜¯æ–°ç‰ˆçš„ logstash-forwarderï¼Œä¹Ÿä¼šæ˜¯ ELK Stack åœ¨ shipper ç«¯çš„ç¬¬ä¸€é€‰æ‹©ã€‚

</pre>

<h1 id="1-å®‰è£…-filebeat">1. å®‰è£… Filebeat</h1>

<h2 id="11-å‡†å¤‡æ¡ä»¶">1.1 å‡†å¤‡æ¡ä»¶</h2>

<p>ELK ç¯å¢ƒåº”è¯¥éƒ¨ç½²å¥½ï¼Œè¿™åœ¨ä¹‹å‰çš„æ–‡ç« å·²ç»é…ç½®è¿‡äº†ã€‚</p>

<h2 id="12-å®‰è£…-filebeat">1.2 å®‰è£… Filebeat</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># ä¸‹è½½å¹¶å®‰è£… Filebeat è½¯ä»¶åŒ…</span>

curl <span class="nt">-L</span> <span class="nt">-O</span> https://download.elastic.co/beats/filebeat/filebeat-1.3.1-x86_64.rpm
rpm <span class="nt">-ivh</span> filebeat-1.3.1-x86_64.rpm

</code></pre></div></div>

<h1 id="2-é…ç½®-filebeat">2. é…ç½® Filebeat</h1>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># æœ¬ä¾‹ä¸»è¦ä¿®æ”¹ 2 éƒ¨åˆ†å‚æ•°</span>

<span class="o">[</span>root@linux-node2 conf.d]# egrep <span class="nt">-v</span> <span class="s2">"#|^$"</span> /etc/filebeat/filebeat.yml
filebeat:
  prospectors:
    -
      paths:
        - /var/log/nginx/access_log_json.log		<span class="c"># å®šä¹‰æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨ Shell GLOB åŒ¹é…</span>
      input_type: log
  registry_file: /var/lib/filebeat/registry
output:
  logstash:			<span class="c"># output å¤„é…ç½®è¾“å‡ºåˆ° logstashï¼Œå…¶å®ä¹Ÿå¯ä»¥ç›´æ¥è¾“å‡ºåˆ° ESï¼Œä½†ä¸èƒ½å¯¹æ—¥å¿—è¿›è¡Œé¢å¤–å¤„ç†</span>
    hosts: <span class="o">[</span><span class="s2">"192.168.56.11:5044"</span><span class="o">]</span>
shipper:
logging:
  files:

</code></pre></div></div>

<blockquote>

  <p>å¯ä»¥åœ¨è¿™æ ·åœ¨ â€œ./filebeat -configtest -eâ€ å‰å°è¿è¡Œ Filebeat æµ‹è¯•é…ç½®æ–‡ä»¶</p>
</blockquote>

<h1 id="3-å¯åŠ¨-filebeat">3. å¯åŠ¨ Filebeat</h1>

<p><code class="highlighter-rouge">/etc/init.d/filebeat start</code></p>

<p>æ­£å¸¸å¯åŠ¨åï¼ŒFilebeat å°±å¯ä»¥å‘é€æ—¥å¿—æ–‡ä»¶æ•°æ®åˆ°ä½ æŒ‡å®šçš„è¾“å‡ºã€‚</p>

<h1 id="4-logstash-é…ç½®--input-beats-æ’ä»¶">4. Logstash é…ç½®  input beats æ’ä»¶</h1>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">[</span>root@linux-node1 ~]# <span class="nb">cat</span> /etc/logstash/conf.d/filebeat.conf 
input <span class="o">{</span>
  beats <span class="o">{</span>
    port <span class="o">=&gt;</span> 5044			<span class="c"># Logstash å¼€å¯ 5044 ç«¯å£ç”¨äºæ¥æ”¶ä¸Šé¢ Filebeat å‘é€è¿‡æ¥çš„æ•°æ®</span>
    <span class="nb">type</span> <span class="o">=&gt;</span> <span class="s2">"logs"</span>
    codec <span class="o">=&gt;</span> <span class="s2">"json"</span>
  <span class="o">}</span>
<span class="o">}</span>

output <span class="o">{</span>
  redis <span class="o">{</span>
    host <span class="o">=&gt;</span> <span class="s2">"192.168.56.12"</span>
    port <span class="o">=&gt;</span> 6379
    db <span class="o">=&gt;</span> 6
    data_type <span class="o">=&gt;</span> <span class="s2">"list"</span>
    key <span class="o">=&gt;</span> <span class="s2">"filebeat"</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>è¿™æ ·å°±å®Œæˆäº† Filebeat æ”¶é›†æ—¥å¿—æ–‡ä»¶æ•°æ®å¹¶å‘é€åˆ° Logstash çš„é…ç½®ã€‚</p>

<h1 id="ref">Ref</h1>
<p><a href="https://www.elastic.co/products/beats/filebeat">Filebeat - Lightweight Shipper for Log Data</a><br />
<a href="https://www.elastic.co/guide/en/beats/filebeat/current/index.html">Filebeat Reference</a><br />
<a href="http://kibana.logstash.es/content/beats/file.html">filebeat</a></p>
:ET