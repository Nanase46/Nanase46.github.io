I"”<h1 id="å¼•è¨€">å¼•è¨€</h1>

<p>å‰å‡ å¤©æµ‹è¯• Murder æ—¶ï¼Œå½“æ²¡å¼€å¯ Tracker æœåŠ¡å™¨æ—¶ï¼Œåœ¨ Peer ä¸‹æ‰§è¡Œä¸‹è½½æ—¶ä¼šæœ‰å¦‚ä¸‹æŠ¥é”™ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@xxx_game dist]# python /usr/local/murder/dist/murder_client.py peer /data/download/server_1262.zip.torrent /data/download/server_1262.zip x.x.x.x
Problem connecting to tracker - <span class="o">[</span>Errno 111] Connection refused
<span class="o">[</span>root@xxx_game dist]# <span class="nb">echo</span> <span class="nv">$?</span>
0
</code></pre></div></div>

<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œå½“åœ¨ Shell å‘½ä»¤è¡Œä¸­æ‰§è¡Œ murder_client.py è„šæœ¬å‡ºé”™åï¼ŒShell çš„ $? è¿”å›å€¼æ˜¯ 0ï¼Œä½†æˆ‘éœ€è¦åœ¨ Shell è„šæœ¬ä¸­æ‰§è¡Œè¿™ä¸ªè„šæœ¬ï¼Œ
å¹¶åˆ¤æ–­è¿™ä¸ª Python è„šæœ¬æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå› ä¸ºåç»­æ“ä½œçš„åˆ¤æ–­ä¼šæ ¹æ®è¿™ä¸ª $?ï¼Œå¦‚æœåƒä¸Šé¢é‚£æ ·å‡ºé”™ï¼Œè¿”å› $? ä¸º 0ï¼Œé‚£ä¹ˆåç»­å°±ä¼šåˆ¤æ–­ Python ä¸‹è½½æˆåŠŸäº†ï¼Œ
è¿™å¯æ˜¯é”™è¯¯çš„ã€‚<br />
æ‰€ä»¥æˆ‘å½“å‰çš„è§£å†³æ–¹æ³•æ˜¯è‡ªå·±åœ¨ Shell è„šæœ¬é‡Œé¢åŠ äº†ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœ Python è„šæœ¬æ‰§è¡Œåè¾“å‡ºç»“æœä¸ä¼šä¸ºç©ºï¼Œä¸ç®¡æç¤ºä¿¡æ¯ä¸ºä½•ï¼Œåˆ¤æ–­ Python è„šæœ¬æ‰§è¡Œ
å¤±è´¥ï¼Œé€šè¿‡ Shell è„šæœ¬è¿”å›ä¸€ä¸ªæç¤ºä¿¡æ¯å’Œé”™è¯¯ç ï¼Œå¦‚ä¸‹ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">result</span><span class="o">=</span><span class="sb">`</span>python /usr/local/murder/dist/murder_client.py peer <span class="k">${</span><span class="nv">download_file</span><span class="k">}</span>.torrent <span class="k">${</span><span class="nv">download_file</span><span class="k">}</span> <span class="nv">$IP</span><span class="sb">`</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$result</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then
    </span><span class="nb">echo</span> <span class="nv">$result</span>
    <span class="nb">echo</span> <span class="s2">"Download error, please check."</span>
    <span class="nb">exit </span>66
<span class="k">fi</span>

</code></pre></div></div>

<h1 id="python-å¼‚å¸¸å¤„ç†åˆ†æ">Python å¼‚å¸¸å¤„ç†åˆ†æ</h1>

<p>ä¸ºä»€ä¹ˆä¸Šé¢ murder_client.py è„šæœ¬å‡ºé”™åï¼ŒShell çš„ $? è¿˜æ˜¯ä¸º 0 å‘¢ï¼Ÿ<br />
æ˜¯è¿™ä¸ª Python è„šæœ¬æ²¡æœ‰å¯¹å¼‚å¸¸è¿›è¡Œ exit æˆ– sys.exit() çš„å¤„ç†ï¼Œè€Œæ˜¯ç›´æ¥æŠ›å‡ºå¼‚å¸¸äº†ã€‚</p>

<p>æ ¹æ®é”™è¯¯æç¤ºï¼Œæœç´¢åˆ°æ”¹é”™è¯¯æç¤ºå¼‚å¸¸å¤„ç†æ˜¯åœ¨<a href="https://github.com/lg/murder/blob/master/dist/BitTornado/BT1/Rerequester.py">è¿™ä¸ªæ–‡ä»¶</a>ä¸­ï¼Œ</p>

<p>æˆªå–å¦‚ä¸‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">err</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">s</span><span class="p">)</span>
    <span class="n">closer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">close</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">except</span> <span class="p">(</span><span class="nb">IOError</span><span class="p">,</span> <span class="n">error</span><span class="p">),</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">err</span> <span class="o">=</span> <span class="s">'Problem connecting to tracker - '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">err</span> <span class="o">=</span> <span class="s">'Problem connecting to tracker'</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">h</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>å½“æ²¡å¼€å¯ Tracker æœåŠ¡å™¨æ—¶ï¼Œåœ¨ Peer ä¸Šæ‰§è¡Œ murder_client.pyï¼Œå°±ä¼šå‡ºç° Tracker æ‹’ç»è¿æ¥çš„æç¤ºï¼Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­å°±å¯¹åº”äº†
IOError å¼‚å¸¸ï¼Œå¹¶æ²¡æœ‰åš exit æˆ– sys.exit() çš„å¤„ç†ã€‚</p>

<h1 id="python-ä¸­çš„-exit-å’Œ-sysexit-çš„åŒºåˆ«">Python ä¸­çš„ exit() å’Œ sys.exit() çš„åŒºåˆ«</h1>

<p>ç°åœ¨æ¥äº†è§£ä¸‹ Python ä¸­çš„ exit() å’Œ sys.exit()ï¼Œ</p>

<blockquote>

  <p>exit is a helper for the interactive shell - sys.exit is intended for use in programs.</p>
</blockquote>

<blockquote>

  <p>The site module (which is imported automatically during startup, except if the -S command-line option is given) adds several constants to the built-in namespace (e.g. exit). They are useful for the interactive interpreter shell and should not be used in programs.</p>
</blockquote>

<blockquote>

  <p>Note that there is a third exit option, namely os._exit, which exits without calling cleanup handlers, flushing stdio buffers, etc. (and which should normally only be used in the child process after a fork()).</p>
</blockquote>

<p>ä¸Šé¢çš„æ„æ€æ˜¯ exit ç”¨äºç»™äº¤äº’å¼ Shell è¿”å›å€¼ï¼Œè€Œ sys.exit æ˜¯ç”¨äºç¨‹åºå†…éƒ¨ã€‚</p>

<ul>
  <li>exit()/quit(), æŠ›å‡º SystemExit å¼‚å¸¸. ä¸€èˆ¬åœ¨äº¤äº’å¼ Shell ä¸­é€€å‡ºæ—¶ä½¿ç”¨.</li>
  <li>sys.exit(n) é€€å‡ºç¨‹åºå¼•å‘ SystemExit å¼‚å¸¸, å¯ä»¥æ•è·å¼‚å¸¸æ‰§è¡Œäº›æ¸…ç†å·¥ä½œ. n é»˜è®¤å€¼ä¸º 0, è¡¨ç¤ºæ­£å¸¸é€€å‡º. å…¶ä»–éƒ½æ˜¯éæ­£å¸¸é€€å‡º. è¿˜å¯ä»¥ sys.exit(â€œsorry, goodbye!â€); ä¸€èˆ¬ä¸»ç¨‹åºä¸­ä½¿ç”¨æ­¤é€€å‡º.</li>
  <li>os._exit(n), ç›´æ¥é€€å‡º, ä¸æŠ›å¼‚å¸¸, ä¸æ‰§è¡Œç›¸å…³æ¸…ç†å·¥ä½œ. å¸¸ç”¨åœ¨å­è¿›ç¨‹çš„é€€å‡º.</li>
</ul>

<h1 id="ref">Ref</h1>
<p><a href="http://stackoverflow.com/questions/6501121/the-difference-between-exit-and-sys-exit-in-python">The difference between exit() and sys.exit() in Python?</a><br />
<a href="http://stackoverflow.com/questions/285289/exit-codes-in-python">Exit codes in Python</a><br />
<a href="https://docs.python.org/2/library/sys.html#sys.exit">sys.exit</a><br />
<a href="https://www.zhihu.com/question/21187839">python ä¸­ os._exit()ï¼Œ sys.exit()ï¼Œ exit() çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</a><br />
<a href="http://www.pythondoc.com/pythontutorial3/errors.html">é”™è¯¯å’Œå¼‚å¸¸</a></p>

:ET