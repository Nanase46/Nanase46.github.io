I"8<h1 id="salt-ssh-ä»‹ç»">Salt SSH ä»‹ç»</h1>

<p>åœ¨ä¹‹å‰æˆ‘ä»¬ä¸€ç›´åœ¨å›´ç»•ç€éœ€è¦åœ¨å—æ§ç«¯å®‰è£… Minion çš„å‰æä¸‹è¿›è¡Œæ¶æ„æ‰©å±•ï¼Œé‚£ä¹ˆå¦‚æœåœ¨å®é™…çš„ç¯å¢ƒä¸­ï¼Œç”±äºæŸäº›é™åˆ¶æ— æ³•åœ¨å—æ§ç«¯æœåŠ¡å™¨å®‰è£… Minion å®¢æˆ·ç«¯ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>

<p>Salt åœ¨ç‰ˆæœ¬ 0.17.0 å½“ä¸­ï¼Œå¼•å…¥äº†æ–°çš„ä¼ è¾“ç³»ç»Ÿï¼Œå®ƒæ”¯æŒé€šè¿‡ SSH é€šé“æ¥å®ç° Salt çš„é€šä¿¡ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ SSH é€šé“åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œä½¿ç”¨ SaltStackï¼Œè€Œä¸éœ€è¦åœ¨è¿œç¨‹ä¸»æœºä¸Šè¿è¡Œ Salt Minion ï¼ŒåŒæ—¶åˆèƒ½æ”¯æŒ SaltStack çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œè€Œä¸” Salt Master ä¹Ÿä¸éœ€è¦è¿è¡Œäº†ã€‚è¿™æ ·ï¼Œä¹Ÿå°±å®ç°äº†å…å®¢æˆ·ç«¯æ–¹å¼çš„éƒ¨ç½²å’Œå®æ–½ã€‚</p>

<p>ä½†æ˜¯ç”±äºæ— å®¢æˆ·ç«¯æœ¬èº«çš„å±€é™æ€§ Salt SSH å¹¶ä¸èƒ½å®Œå…¨å–ä»£æ ‡å‡†çš„ Salt é€šä¿¡æ–¹å¼ï¼Œåªæ˜¯ç®€å•åœ°æä¾›äº†ä¸€ä¸ªåŸºäº SSH é€šé“çš„å¯é€‰æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ä¸éœ€è¦ ZeroMQ å’Œè¿œç¨‹ Agent çš„æ”¯æŒï¼›æ•´ä½“çš„å·¥ä½œæµç¨‹å’ŒåŸºäºå®¢æˆ·ç«¯æ¶æ„å¤§è‡´ç›¸åŒã€‚ä½†å¿…é¡»æ„è¯†åˆ°ï¼Œé€šè¿‡ Salt SSH çš„æ‰§è¡Œé€Ÿåº¦ä¼šè¿œè¿œä½äº ZeroMQ æ”¯æŒçš„æ ‡å‡†çš„ Salt é€šä¿¡æ–¹å¼ã€‚</p>

<p>å®‰è£… salt-ssh å¦‚ä¸‹ï¼š</p>
<blockquote>

  <p>yum install salt-ssh -y</p>
</blockquote>

<p>åœ¨ä¼ ç»Ÿçš„ Master å’Œ Minion çš„æ¶æ„ä¸­ï¼ŒMinion ä¼šä¸»åŠ¨è¿æ¥ Masterï¼Œæ‰€ä»¥ Master ä¸éœ€è¦æ‰‹å·¥é…ç½®ç›®æ ‡ç³»ç»Ÿçš„ä¿¡æ¯ã€‚ä½†æ˜¯ä½¿ç”¨ Salt SSHï¼Œæ§åˆ¶æœåŠ¡å™¨å°±éœ€è¦è¿™äº›ã€‚SaltStack ä½¿ç”¨ Rosters æ¥ç®¡ç†è¿™äº›æ•°æ®ã€‚</p>

<h1 id="salt-rosters">Salt Rosters</h1>

<p>Roster ç³»ç»Ÿä¸ºå¯æ’æ‹”è®¾è®¡ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°åŠ å…¥åˆ°å·²æœ‰çš„ç³»ç»Ÿä¸­ï¼Œç”¨äº Salt SSH è·å–éœ€è¦è¿æ¥çš„æœåŠ¡å™¨ä¿¡æ¯ã€‚é»˜è®¤æƒ…å†µä¸‹ Roster æ–‡ä»¶æœ¬åœ°è·¯å¾„ä¸ºï¼š/etc/salt/rosterã€‚</p>

<p>Roster ç³»ç»Ÿç¼–è¯‘äº†ä¸€ä¸ªå†…éƒ¨æ•°æ®ç»“æ„ï¼Œç§°ä¸º Targetsã€‚Targets æ˜¯ä¸€ä¸ªç›®æ ‡ç³»ç»Ÿå’Œå…³äºå¦‚ä½•è¿æ¥åˆ°ç³»ç»Ÿå±æ€§çš„åˆ—è¡¨ã€‚å¯¹äºä¸€ä¸ªåœ¨ Salt ä¸­çš„ Roster æ¨¡å—æ¥è¯´ï¼Œå”¯ä¸€è¦æ±‚æ˜¯è¿”å› Targets æ•°æ®ç»“æ„ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;SaltID&gt;ï¼š 	<span class="c"># ç›®æ ‡ ID</span>
  hostï¼š 	<span class="c"># è¿œç¨‹ä¸»æœºçš„ IP åœ°å€æˆ–è€…ä¸»æœºå</span>
  userï¼š 	<span class="c"># å¯ä»¥ç™»å½•çš„ç”¨æˆ·</span>
  passwdï¼š 	<span class="c"># å¯ä»¥ç™»å½•ç”¨æˆ·çš„å¯†ç </span>
<span class="c"># å¯é€‰å‚æ•°</span>
  portï¼š 	<span class="c"># SSH ç«¯å£</span>
  <span class="nb">sudo</span>ï¼š 	<span class="c"># æ˜¯å¦è¿è¡Œ sudoï¼Œè®¾ç½® True æˆ–è€… False</span>
  privï¼š 	<span class="c"># SSH ç§é’¥çš„è·¯å¾„ï¼Œé»˜è®¤æ˜¯ salt-ssh.rsa</span>
  <span class="nb">timeout</span>ï¼š <span class="c"># è¿æ¥ SSH æ—¶çš„è¶…æ—¶æ—¶é—´</span>
  thin_dirï¼š# ç›®æ ‡ç³»ç»Ÿ Salt çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯ /tmp/salt-&lt;<span class="nb">hash</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>æ·»åŠ ä¸¤ä¸ªæµ‹è¯• Minionï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@linux-node1 ~]# <span class="nb">cat</span> /etc/salt/roster
linux-node1.example.com:
  host: 192.168.56.11
  port: 22
  user: root

linux-node2.example.com:
  host: 192.168.56.12
  port: 22
  user: root
</code></pre></div></div>

<h1 id="ä½¿ç”¨-salt-ssh">ä½¿ç”¨ Salt SSH</h1>

<p>ç¬¬ä¸€æ¬¡è¿è¡Œ Salt SSH ä¼šæç¤ºè¿›è¡Œ salt-ssh key çš„éƒ¨ç½²ï¼Œéœ€è¦åœ¨ Rosters ä¸­é…ç½®ç”¨æˆ·çš„å¯†ç ï¼Œå³å¯è¿›è¡Œ Key çš„éƒ¨ç½²ï¼Œåˆå§‹åŒ–ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@linux-node1 ~]# salt-ssh <span class="s1">'*'</span> test.ping <span class="nt">-i</span>
Permission denied <span class="k">for </span>host linux-node2.example.com, <span class="k">do </span>you want to deploy the salt-ssh key? <span class="o">(</span>password required<span class="o">)</span>:
<span class="o">[</span>Y/n] Y
Password <span class="k">for </span>root@linux-node2.example.com: 
linux-node2.example.com:
    True
Permission denied <span class="k">for </span>host linux-node1.example.com, <span class="k">do </span>you want to deploy the salt-ssh key? <span class="o">(</span>password required<span class="o">)</span>:
<span class="o">[</span>Y/n] Y
Password <span class="k">for </span>root@linux-node1.example.com: 
linux-node1.example.com:
    True
</code></pre></div></div>

<p>å½“éƒ¨ç½²è¿‡ Key ä¹‹åï¼ŒåæœŸå†æ‰§è¡Œ Salt SSH å°±ä¼šé€šè¿‡å¯†é’¥è®¤è¯ï¼Œä¸éœ€è¦ç”¨æˆ·å†è¾“å…¥å¯†ç äº†ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@linux-node1 ~]# salt-ssh <span class="s1">'*'</span> test.ping 
linux-node1.example.com:
    True
linux-node2.example.com:
    True
</code></pre></div></div>

<h1 id="åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨</h1>

<p>salt-ssh å‘½ä»¤çš„è¯­æ³•å’Œ Salt å‘½ä»¤ç±»ä¼¼ï¼Œä¸‹é¢çœ‹å‡ ä¸ªå…¸å‹çš„ä½¿ç”¨åœºæ™¯ã€‚</p>

<h2 id="1-salt-ssh-target">1 Salt SSH Target</h2>

<p>ç›¸å¯¹äº C/S æ¨¡å¼ï¼Œsalt-ssh åœ¨ Target ä¸­è¿˜æœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œç›®å‰æ”¯æŒå¦‚ä¸‹åŒ¹é…æ¨¡å¼ï¼š</p>

<ul>
  <li>-E pcre æ­£åˆ™åŒ¹é…</li>
  <li>-L list åˆ—è¡¨åŒ¹é…</li>
  <li>-G grain grains åŒ¹é…</li>
  <li>-grain-pcre grains åŠ æ­£åˆ™åŒ¹é…</li>
  <li>-N nodegroup ç»„åŒ¹é…</li>
  <li>-R range èŒƒå›´åŒ¹é…</li>
</ul>

<h2 id="2-å‘½ä»¤æ‰§è¡Œ">2 å‘½ä»¤æ‰§è¡Œ</h2>

<p>é»˜è®¤æƒ…å†µä¸‹ salt-ssh å¯ä»¥ç›´æ¥åœ¨è¿œç¨‹ç³»ç»Ÿä¸Šè¿è¡Œ Salt æ‰§è¡Œæ¨¡å—ã€‚é€šè¿‡ salt-ssh ä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡ŒåŸå§‹ shell å‘½ä»¤ï¼š</p>
<blockquote>

  <p>[root@linux-node1 ~]# salt-ssh â€˜*â€™ -r â€˜wâ€™</p>
</blockquote>

<p>è¯¥å‘½ä»¤åŸºæœ¬ç­‰åŒäº salt â€˜<em>â€™ cmd.run â€˜wâ€™ <br />
æ‰§è¡Œå…¶ä»–æ¨¡å—æ—¶ä¹Ÿç±»ä¼¼ï¼Œå¦‚ salt-ssh â€˜</em>â€™ disk.usage</p>

<h2 id="3-çŠ¶æ€ç®¡ç†">3 çŠ¶æ€ç®¡ç†</h2>

<p>salt-ssh å‘½ä»¤å¯ä»¥ç›´æ¥ä½¿ç”¨ Salt çŠ¶æ€ç®¡ç†ç³»ç»Ÿã€‚ä½¿ç”¨æ—¶å°† salt å‘½ä»¤ç›´æ¥æ›¿æ¢ä¸º salt-ssh å³å¯ï¼š</p>
<blockquote>

  <p>salt-ssh â€˜*â€™ state.sls init.dns</p>
</blockquote>

<p>ä¸Šé¢çš„å‘½ä»¤åŸºæœ¬ç­‰åŒäº salt â€˜*â€™ state.sls init.dns</p>

<h1 id="ç”Ÿäº§å®è·µ">ç”Ÿäº§å®è·µ</h1>

<p>åœ¨å®é™…çš„ç”Ÿäº§ä½¿ç”¨ä¸­ï¼Œå»ºè®®å°†ä¼ ç»Ÿçš„ Masterã€Minion å’Œ salt-ssh ä¸€èµ·ä½¿ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ salt-ssh æ¥è¿›è¡Œ Salt Minion çš„å‡çº§ï¼Œå¯ä»¥ä½¿ç”¨ salt-minion æ¥å®ç° salt-ssh çš„è‡ªåŠ¨åŒ–éƒ¨ç½²ç­‰ã€‚</p>

<p>è¿™é‡Œæˆ‘ä»¬æ¥ä»‹ç»å¦‚ä½•åŸºäºç°æœ‰çš„ Masterã€Minion æ¶æ„è‡ªåŠ¨æ„å»º Salt SSH ç¯å¢ƒã€‚ç»è¿‡ä¸Šé¢å¯¹ Salt SSH çš„ä»‹ç»ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»çŸ¥é“è¦å®ç° Salt SSH æ¶æ„éœ€è¦ä¸¤ä¸ªé‡è¦çš„æ­¥éª¤ï¼š</p>

<ol>
  <li>ç”Ÿæˆ Rosters é…ç½®æ–‡ä»¶ã€‚</li>
  <li>æŠŠå¯†é’¥æ”¾ç½®åˆ° Salt Minion ä¸Šã€‚</li>
</ol>

<p>é’ˆå¯¹è¿™ä¸¤ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œå®ç°ã€‚</p>

<ul>
  <li>ä½¿ç”¨ salt-mine å®ç° Salt Rosters æ–‡ä»¶çš„è‡ªåŠ¨ç”Ÿæˆã€‚</li>
  <li>ä½¿ç”¨ Salt çš„æ–‡ä»¶çŠ¶æ€æ¨¡å—ç®¡ç† Minion ä¸Šçš„ authorized_keysã€‚æœ¬è´¨æ˜¯å°† ssh-keyï¼ˆæ³¨ï¼šç¬¬ä¸€æ¬¡æ‰§è¡Œ salt-ssh æ·»åŠ ä¸»æœºæ—¶ä¼šç”Ÿæˆï¼Œé»˜è®¤å­˜æ”¾åœ¨ /etc/salt/pki/master/ssh/salt-ssh.rsa.pub çš„å…¬é’¥ï¼‰å†™å…¥åˆ°ç”¨æˆ·ä¸»ç›®å½• .ssh/authorized_keys æ–‡ä»¶ä¸­ã€‚</li>
</ul>

<h2 id="1-ç¼–å†™çŠ¶æ€é…ç½®">1 ç¼–å†™çŠ¶æ€é…ç½®</h2>

<p>é¦–å…ˆæˆ‘ä»¬åœ¨ base ç¯å¢ƒä¸­åˆ›å»º salt ç›®å½•ï¼Œç”¨æ¥å­˜æ”¾æˆ‘ä»¬ç¼–å†™çš„ salt-ssh ç›¸å…³çš„çŠ¶æ€é…ç½®ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@linux-node1 <span class="o">]</span><span class="c"># mkdir /srv/salt/base/salt/files -p</span>
<span class="o">[</span>root@linux-node1 <span class="o">]</span><span class="c"># mkdir /srv/pillar/base/salt -p</span>
<span class="o">[</span>root@linux-node1 <span class="o">]</span><span class="c"># vim /srv/salt/base/salt/ssh.sls</span>
<span class="c"># åˆ›å»º salt ç”¨æˆ·</span>
salt-user:
  user.present:
    - name: salt

<span class="c"># ç®¡ç† salt-ssh çš„ sudo æ–‡ä»¶</span>
salt-ssh-sudo:
  file.managed:
    - name: /etc/sudoers.d/salt
    - <span class="nb">source</span>: salt://salt/files/salt-sudo
    - user: root
    - group: root
    - mode: 644
    - require:
      - user: salt-user

<span class="c"># ä½¿ç”¨ ssh_auth æ¨¡å—ç®¡ç†å…¬é’¥</span>
salt-ssh-key:
  ssh_auth.present:
    - user: salt
    - <span class="nb">source</span>: salt://salt/files/salt-ssh.rsa.pub
    - require:
      - user: salt-user

<span class="o">[</span>root@linux-node1 salt]# vim /srv/salt/base/salt/roster.sls
<span class="c"># ç”Ÿæˆ roster-auto æ–‡ä»¶ï¼Œä¸ºäº†å’Œé»˜è®¤çš„ roster è¿›è¡ŒåŒºåˆ†</span>
salt-ssh-roster:
  file.managed:
    - name: /etc/salt/roster-auto
    - <span class="nb">source</span>: salt://salt/files/roster
    - template: jinja
</code></pre></div></div>

<h2 id="2-é…ç½®-salt-mine">2 é…ç½® Salt-Mine</h2>

<p>ä¸‹é¢æˆ‘ä»¬éœ€è¦ä½¿ç”¨ salt mine æ¥è·å–æ‰€æœ‰ Minion çš„ IP åœ°å€ï¼Œç”¨äºè‡ªåŠ¨å¡«å…… roster æ–‡ä»¶ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /srv/pillar/base/salt/mine.sls
mine_functions:
  network.ip_addrs:
    - eth0

<span class="c"># å¢åŠ åˆ° Pillar çš„ top file ä¸­ï¼š</span>

vim /srv/pillar/base/top.sls
base:
  <span class="s1">'*'</span>:
    - salt.mine

<span class="c"># åˆ·æ–° Pillar çš„ æ•°æ®</span>
<span class="o">[</span>root@linux-node1 salt]# salt <span class="s1">'*'</span> saltutil.refresh_pillar
linux-node1.example.com:
    True
linux-node2.example.com:
    True

<span class="c"># æµ‹è¯• Mine é…ç½®</span>
<span class="o">[</span>root@linux-node1 salt]# salt <span class="s1">'*'</span> pillar.get mine_functions
linux-node1.example.com:
    <span class="nt">----------</span>
    network.ip_addrs:
        - eth0
linux-node2.example.com:
    <span class="nt">----------</span>
    network.ip_addrs:
        - eth0

<span class="c"># æ›´æ–° Mine æ•°æ®</span>
<span class="o">[</span>root@linux-node1 salt]# salt <span class="s1">'*'</span> mine.update
linux-node1.example.com:
    True
linux-node2.example.com:
    True

<span class="c"># æµ‹è¯• Mine è·å– Minion ID å’Œ IP åœ°å€ï¼š</span>
<span class="o">[</span>root@linux-node1 salt]# salt <span class="s1">'*node1*'</span> mine.get <span class="s1">'*'</span> network.ip_addrs
linux-node1.example.com:
    <span class="nt">----------</span>
    linux-node1.example.com:
        - 192.168.56.11
    linux-node2.example.com:
        - 192.168.56.12
<span class="c"># å¯ä»¥çœ‹åˆ°ã€‚æˆ‘ä»¬å¯ä»¥æ­£å¸¸è·å–åˆ°æ‰€æœ‰ Minion çš„ ID å’Œ IP åœ°å€ã€‚ä¸‹é¢æˆ‘ä»¬å°†æ•°æ®å†™å…¥åˆ° roster æ–‡ä»¶å³å¯ã€‚</span>
</code></pre></div></div>

<h1 id="3-å‡†å¤‡ç›¸å…³æ–‡ä»¶">3 å‡†å¤‡ç›¸å…³æ–‡ä»¶</h1>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># å°† Salt SSHçš„å…¬é’¥å¤åˆ¶åˆ° files ç›®å½•ä¸‹ï¼š</span>
<span class="nb">cp</span> /etc/salt/pki/master/ssh/salt-ssh.rsa.pub /srv/salt/base/salt/files/

<span class="c"># åˆ›å»º Salt çš„ sudo æ–‡ä»¶ï¼š</span>
vim /srv/salt/base/salt/files/salt-sudo
Defaults:salt <span class="o">!</span>requiretty
salt <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD: ALL

<span class="c"># åˆ›å»º roster æ¨¡æ¿ï¼Œåœ¨ Jinja ä¸­ä½¿ç”¨ salt-mine è·å–ä¸»æœºçš„ Minion ID å’Œ IP åœ°å€ï¼š</span>
vim /srv/salt/base/salt/files/roster
<span class="o">[</span>roster æ–‡ä»¶]<span class="o">(</span>https://jaminzhang.github.io/soft-conf/SaltStack/salt-roster-template.yaml<span class="o">)</span>
</code></pre></div></div>

<h1 id="4-æ‰§è¡ŒçŠ¶æ€å¹¶æµ‹è¯•">4 æ‰§è¡ŒçŠ¶æ€å¹¶æµ‹è¯•</h1>

<p>ä¸‹é¢æˆ‘ä»¬å°±å¯ä»¥æ¥æ‰§è¡ŒçŠ¶æ€ï¼Œè‡ªåŠ¨åŒ–éƒ¨ç½² Salt SSH çš„ key å’Œ è‡ªåŠ¨ç”Ÿæˆ roster æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬ä¹‹å‰é…ç½®çš„ç›®å½•ç»“æ„ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@linux-node1 ~]# <span class="nb">cd</span> /srv/salt/base/salt/
<span class="o">[</span>root@linux-node1 salt]# tree
<span class="nb">.</span>
â”œâ”€â”€ files
â”‚Â Â  â”œâ”€â”€ roster
â”‚Â Â  â”œâ”€â”€ salt-ssh.rsa.pub
â”‚Â Â  â””â”€â”€ salt-sudo
â”œâ”€â”€ roster.sls
â””â”€â”€ ssh.sls
</code></pre></div></div>

<p>ç¬¬ä¸€æ­¥ï¼šæ‰§è¡Œ salt.ssh çŠ¶æ€ï¼Œåœ¨æ‰€æœ‰ Minion ç«¯åˆ›å»º salt ç”¨æˆ·ï¼Œæ”¾ç½® sudo é…ç½®å’Œå…¬é’¥</p>
<blockquote>

  <p>salt â€˜<em>node1</em>â€™ state.sls salt.ssh</p>
</blockquote>

<p>ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œ salt.roster çŠ¶æ€ï¼Œæ³¨æ„åªåœ¨ Salt Master æ‰§è¡Œå³å¯ï¼Œç”Ÿæˆ roster æ–‡ä»¶</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@linux-node1 salt]# salt <span class="s1">'*node1*'</span> state.sls salt.roster
<span class="o">[</span>root@linux-node1 salt]# <span class="nb">cat</span> /etc/salt/roster-auto 
linux-node1.example.com:
  host: 192.168.56.11
  user: salt
  <span class="nb">sudo</span>: True
linux-node2.example.com:
  host: 192.168.56.12
  user: salt
  <span class="nb">sudo</span>: True
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°å·²ç»æ­£ç¡®ç”Ÿæˆäº† roster æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ salt ssh è¿›è¡Œæ“ä½œäº†ã€‚<br />
æ³¨æ„ï¼šéœ€è¦ä½¿ç”¨ â€“roster-file æ¥æŒ‡å®š roster æ–‡ä»¶ã€‚è¿™æ ·ä¸€äº›è‡ªå®šä¹‰çš„ä¸»æœºå¯ä»¥åœ¨é»˜è®¤çš„ /etc/salt/roster æ–‡ä»¶ä¸­ï¼Œ
è‡ªåŠ¨ç”Ÿæˆçš„ä½¿ç”¨ /etc/salt/roster-autoã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@linux-node1 salt]# salt-ssh <span class="nt">--roster-file</span><span class="o">=</span>/etc/salt/roster-auto <span class="s1">'*'</span> test.ping
linux-node1.example.com:
    True
linux-node2.example.com:
    True
</code></pre></div></div>

<h1 id="é‡åˆ°çš„é—®é¢˜">é‡åˆ°çš„é—®é¢˜</h1>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@linux-node1 ~]# salt-ssh <span class="nt">-i</span> <span class="s1">'*'</span> test.ping
<span class="o">[</span>ERROR   <span class="o">]</span> An un-handled exception was caught by salt<span class="s1">'s global exception handler:
UnicodeEncodeError: '</span>ascii<span class="s1">' codec can'</span>t encode character u<span class="s1">'\uff1a'</span> <span class="k">in </span>position 23: ordinal not <span class="k">in </span>range<span class="o">(</span>128<span class="o">)</span>
</code></pre></div></div>

<p>/etc/salt/roster æ–‡ä»¶ä¸­åŒ…å«ä¸­æ–‡ç¬¦å·</p>

<h1 id="ref">Ref</h1>
<p><a href="https://docs.saltstack.com/en/latest/topics/ssh/index.html">SALT SSH</a></p>

:ET