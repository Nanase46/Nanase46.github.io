I"’<h1 id="zabbix-ä¸­ç›‘æ§-mysql-æ–¹å¼">Zabbix ä¸­ç›‘æ§ MySQL æ–¹å¼</h1>

<h2 id="1-ä½¿ç”¨è‡ªå¸¦æ¨¡æ¿ç›‘æ§-mysql">1. ä½¿ç”¨è‡ªå¸¦æ¨¡æ¿ç›‘æ§ MySQL</h2>

<p>Zabbix-Agent æœ¬èº«å¹¶æ²¡æœ‰æä¾›ç›´æ¥å¯¹ MySQL ç›‘æ§çš„ Keyï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦é€šè¿‡è‡ªå®šä¹‰ Key æ¥åº”ç”¨è‡ªå¸¦çš„ MySQL æ¨¡æ¿ã€‚</p>

<p>å…·ä½“æ­¥éª¤æš‚ä¸è¯´æ˜ã€‚æœ¬æ–‡ä¸»è¦è¯´æ˜ä½¿ç”¨ Percona Monitoring Plugins ç›‘æ§ MySQL çš„æ–¹å¼ã€‚</p>

<h2 id="2-ä½¿ç”¨-percona-monitoring-plugins-ç›‘æ§-mysql">2. ä½¿ç”¨ Percona Monitoring Plugins ç›‘æ§ MySQL</h2>

<h1 id="ä½¿ç”¨-percona-monitoring-plugins-ç›‘æ§-mysql">ä½¿ç”¨ Percona Monitoring Plugins ç›‘æ§ MySQL</h1>

<h2 id="1-ç³»ç»Ÿéœ€æ±‚">1. ç³»ç»Ÿéœ€æ±‚</h2>

<p>è¢«ç›‘æ§æœåŠ¡å™¨ä¸Šå®‰è£… zabbix-agent, php, php-mysql</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">[</span>root@linux-node1 ~]# yum <span class="nb">install </span>zabbix-agent php php-mysql
<span class="o">[</span>root@linux-node1 ~]# rpm <span class="nt">-qa</span> zabbix-agent php php-mysql
php-mysql-5.4.16-36.1.el7_2.1.x86_64
php-5.4.16-36.1.el7_2.1.x86_64
zabbix-agent-3.0.3-1.el7.x86_64

</code></pre></div></div>

<h2 id="2-å®‰è£…é…ç½®-percona-zabbix-templates">2. å®‰è£…é…ç½® percona-zabbix-templates</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># å®‰è£… percona-zabbix-templates</span>
yum <span class="nb">install </span>https://www.percona.com/downloads/percona-monitoring-plugins/1.1.6/percona-zabbix-templates-1.1.6-1.noarch.rpm
<span class="c"># ä¹Ÿå¯é…ç½® Percona yum ä»“åº“åå®‰è£… </span>
<span class="c"># yum install https://www.percona.com/redir/downloads/percona-release/redhat/latest/percona-release-0.1-3.noarch.rpm</span>
 
<span class="c"># é…ç½® Zabbix Agent</span>
<span class="nb">cp</span> /var/lib/zabbix/percona/templates/userparameter_percona_mysql.conf /etc/zabbix/zabbix_agentd.d/

systemctl restart zabbix-agent

</code></pre></div></div>

<h2 id="3-é…ç½®-agent-ä¸Šçš„-mysql-è¿æ¥">3. é…ç½® Agent ä¸Šçš„ MySQL è¿æ¥</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># åˆ›å»º .cnf æ–‡ä»¶æŒ‡å®š MySQL ç”¨æˆ·åå’Œå¯†ç </span>

<span class="c"># ç”Ÿäº§ç¯å¢ƒè¯·ä¸€å®šè¦è®¾ç½®å¤æ‚å¯†ç </span>
<span class="o">[</span>root@linux-node1 ~]# <span class="nb">cat</span> /var/lib/zabbix/percona/scripts/ss_get_mysql_stats.php.cnf
&lt;?php
<span class="nv">$mysql_user</span> <span class="o">=</span> <span class="s1">'zabbix'</span><span class="p">;</span>
<span class="nv">$mysql_pass</span> <span class="o">=</span> <span class="s1">'zabbix'</span><span class="p">;</span>

<span class="c"># æµ‹è¯•è„šæœ¬</span>
<span class="o">[</span>root@linux-node1 ~]# /var/lib/zabbix/percona/scripts/get_mysql_stats_wrapper.sh gg

<span class="c"># é…ç½® ~zabbix/.my.cnfï¼Œå†…å®¹å¦‚ä¸‹ï¼š</span>
<span class="o">[</span>root@linux-node1 ~]# <span class="nb">cat</span> ~zabbix/.my.cnf
<span class="o">[</span>client]
user <span class="o">=</span> zabbix
password <span class="o">=</span> zabbix

<span class="c"># zabbix ç”¨æˆ·æµ‹è¯•è„šæœ¬</span>
<span class="o">[</span>root@linux-node1 ~]# <span class="nb">sudo</span> <span class="nt">-u</span> zabbix <span class="nt">-H</span> /var/lib/zabbix/percona/scripts/get_mysql_stats_wrapper.sh running-slave
0

</code></pre></div></div>

<h2 id="4-é…ç½®-zabbix-server">4. é…ç½® Zabbix Server</h2>

<ol>
  <li>å» https://www.percona.com/downloads/percona-monitoring-plugins/ ä¸‹è½½ Percona Monitoring Plugins æœ€æ–° tar.gz æºç åŒ…<br />
  ï¼ˆå¦‚æœä½¿ç”¨ Zabbix 3.0ï¼Œè‡ªå¸¦æ¨¡æ¿æœ‰ç‚¹æ—§äº†ï¼Œå¹¶ä¸èƒ½å¯¼å…¥ä½¿ç”¨ï¼Œåé¢ç»™å‡ºè§£å†³åŠæ³•ï¼‰</li>
  <li>è§£å‹è·å– <code class="highlighter-rouge">zabbix/templates/</code> ç›®å½•</li>
  <li>é€šè¿‡ Zabbix Web ç•Œé¢  (Configuration -&gt; Templates -&gt; Import) å¯¼å…¥ XML æ¨¡æ¿ï¼Œæ³¨æ„è¦å¦å¤–é€‰æ‹©ä¸Š Screens.</li>
  <li>é…ç½®ä¸»æœºå…³è”ä¸Š Percona MySQL Server Template æ¨¡æ¿ã€‚</li>
</ol>

<h1 id="é‡åˆ°çš„é—®é¢˜">é‡åˆ°çš„é—®é¢˜</h1>

<ol>
  <li>å¦‚æœä½¿ç”¨ Zabbix 3.0ï¼Œè‡ªå¸¦æ¨¡æ¿æ¯”è¾ƒæ—§ï¼Œå¹¶ä¸èƒ½å¯¼å…¥ä½¿ç”¨<br />
æç¤ºå¦‚ä¸‹ï¼š<br />
`
Invalid tag â€œ/zabbix_export/dateâ€: â€œYYYY-MM-DDThh:mm:ssZâ€ is expected.<br />
Invalid tag â€œ/zabbix_export/templates/template(1)/items/item(1)â€: the tag â€œsnmp_communityâ€ is missing.<br />
`</li>
</ol>

<p>è§£å†³æ–¹æ³•ï¼š
æ‰‹åŠ¨ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶è§£å†³æŠ¥é”™æ¯”è¾ƒéº»çƒ¦ï¼Œæœ‰äººæåˆ°å¯ä»¥å°†æ­¤æ¨¡æ¿å¯¼å…¥ Zabbix 2.X ç³»åˆ—åï¼Œå†å¯¼å‡ºåˆ° Zabbix 3.0ã€‚<br />
è¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ç°æˆå¯ç”¨çš„ Zabbix 3.X çš„ percona-zabbix-templates <br />
<a href="http://jaminzhang.github.io/soft-conf/Zabbix/zbx_percona_mysql_template.xml">zbx_percona_mysql_template.xml æ¨¡æ¿åœ°å€</a></p>

<ol>
  <li>ä¸å‡ºå›¾</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># zabbix_get èƒ½è·å–æ•°æ®ï¼Œä½†æ˜¯ä¸å‡ºå›¾ã€‚</span>
<span class="o">[</span>root@linux-node1 ~]# zabbix_get <span class="nt">-s</span> 192.168.56.11 <span class="nt">-k</span> <span class="s2">"MySQL.max-connections"</span>
151

<span class="c"># æŸ¥çœ‹çŠ¶æ€æ–‡ä»¶æƒé™ï¼Œä¸ºä¹‹å‰æµ‹è¯•è„šæœ¬æ—¶çš„ root æƒé™ï¼Œzabbix ç”¨æˆ·å¹¶ä¸èƒ½è¯»å†™ï¼Œæ‰€ä»¥è·å–ä¸åˆ°æ•°æ®</span>
<span class="o">[</span>root@linux-node1 ~]# ll /tmp/localhost-mysql_cacti_stats.txt 
<span class="nt">-rw-r--r--</span> 1 root root 1374 Jun 22 11:33 /tmp/localhost-mysql_cacti_stats.txt

<span class="c"># åˆ é™¤ root ç”¨æˆ·æµ‹è¯•æ—¶ç”Ÿæˆçš„ mysql çŠ¶æ€æ–‡ä»¶</span>
<span class="o">[</span>root@linux-node1 ~]# <span class="nb">rm</span> <span class="nt">-f</span>  /tmp/localhost-mysql_cacti_stats.txt 
<span class="c"># ä¼šè‡ªåŠ¨ç”Ÿæˆ zabbix ç”¨æˆ·æƒé™çš„ mysql çŠ¶æ€æ–‡ä»¶</span>
<span class="o">[</span>root@linux-node1 ~]# ll  /tmp/localhost-mysql_cacti_stats.txt 
<span class="nt">-rw-rw-r--</span> 1 zabbix zabbix 1374 Jun 22 11:41 /tmp/localhost-mysql_cacti_stats.txt
<span class="c"># è¿‡ä¸€ä¼šå„¿å°±å¯ä»¥çœ‹åˆ°å‡ºå›¾äº†</span>

</code></pre></div></div>

<h1 id="ref">Ref</h1>
<p><a href="https://www.percona.com/doc/percona-monitoring-plugins/1.1/zabbix/index.html">Percona Monitoring Plugins for Zabbix</a><br />
<a href="https://www.percona.com/forums/questions-discussions/percona-monitoring-plugins/43888-the-tag-snmp_community-is-missing">the tag â€œsnmp_communityâ€ is missing.</a><br />
<a href="http://sysblog.sund.org/zabbix-and-percona/">ZABBIX AND PERCONA</a></p>

:ET