I"Õ<p>Python Socket ç¼–ç¨‹å…¥é—¨æ¼”ç¤º</p>

<h1 id="å¼•è¨€">å¼•è¨€</h1>
<p>ä»Šå¤©ç”µè¯é¢è¯•æœ‰ä¸ªé—®é¢˜ï¼Œæ˜¯é—®æˆ‘æ€ä¹ˆç”¨ Python è¿›è¡Œ Socket ç¼–ç¨‹ï¼Œå› ä¸ºè‡ªå·±å¾ˆä¹…æ²¡æœ‰ç”¨ Python å†™è¿‡ä¸œè¥¿äº†ï¼ŒSocket ç¼–ç¨‹è®°å¾—å¾ˆä¹…ä¹‹å‰çœ‹è¿‡ï¼Œä½†å…·ä½“æ€ä¹ˆç¼–å†™ï¼ŒSocket æ¨¡å—ç›¸å…³çš„æ–¹æ³•ï¼Œç¡®å®å¿˜è®°äº†ã€‚<br />
ä¸€ç›´æ²¡æœ‰ç¢°åˆ°å†™è¿™ä¸ªçš„éœ€æ±‚ï¼Œæ‰€ä»¥å°±ä¸çŸ¥é“å…·ä½“æ€ä¹ˆå†™äº†ã€‚<br />
æ‰€ä»¥ç°åœ¨æˆ‘å°±æŠŠè¿™ä¸ªé—®é¢˜å½“åšä¸€ä¸ªéœ€æ±‚ï¼Œé‡æ–°å­¦ä¹ ä¸€ä¸‹ Python Socket ç¼–ç¨‹å…·ä½“è¿‡ç¨‹ä¸ç¼–ç ã€‚
çœ‹äº† Python Socket ç¼–ç¨‹ç›¸å…³èµ„æ–™æ¼”ç¤ºï¼Œè¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“å¿«é€Ÿä¸Šæ‰‹çš„ã€‚</p>

<h1 id="tcp-socket-ç¼–ç¨‹è¿‡ç¨‹ä¸æ–¹æ³•å›¾ç¤º">TCP Socket ç¼–ç¨‹è¿‡ç¨‹ä¸æ–¹æ³•å›¾ç¤º</h1>

<p><img src="http://s3.51cto.com/wyfs02/M01/8A/DD/wKiom1g9Z5iS1tf9AAFr9XDUJts955.png" alt="TCP Socket ç¼–ç¨‹è¿‡ç¨‹ä¸æ–¹æ³•å›¾ç¤º" /></p>

<h1 id="python-ç®€å•-socket-é€šä¿¡æ¨¡å‹ç¼–ç¨‹è¿‡ç¨‹ä¸æ¼”ç¤º">Python ç®€å• Socket é€šä¿¡æ¨¡å‹ç¼–ç¨‹è¿‡ç¨‹ä¸æ¼”ç¤º</h1>

<h2 id="socket-server-æœåŠ¡ç«¯è„šæœ¬æ–‡ä»¶">socket server æœåŠ¡ç«¯è„šæœ¬æ–‡ä»¶</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
# -*- coding:utf-8 -*-
</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="c1"># ä»¥å…ƒç»„å½¢å¼å®šä¹‰ä¸€ä¸ª IP åœ°å€å’Œç«¯å£
</span><span class="n">ip_port</span> <span class="o">=</span> <span class="p">(</span><span class="s">'127.0.0.1'</span><span class="p">,</span><span class="mi">9999</span><span class="p">)</span>

<span class="c1"># åˆ›å»ºå¯¹è±¡å¹¶ç»‘å®š IP åœ°å€å¼€å§‹ç›‘å¬
</span><span class="n">sk</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
<span class="n">sk</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">ip_port</span><span class="p">)</span>
<span class="n">sk</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># å¼€å§‹æ¥æ”¶æ¶ˆæ¯
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">'server waiting...'</span>
    <span class="c1"># conn è¡¨ç¤ºå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥åçš„ä¸“æœ‰é€šä¿¡çº¿è·¯
</span>    <span class="n">conn</span><span class="p">,</span><span class="n">addr</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span> <span class="c1"># accept å±äºé˜»å¡å¼ï¼Œæ²¡æœ‰æ”¶åˆ°è¿æ¥è¯·æ±‚å°±ä¸ä¼šç»§ç»­å‘ä¸‹è¿è¡Œ
</span>
    <span class="c1"># æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„æ¶ˆæ¯
</span>    <span class="n">client_data</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span> <span class="c1"># recv ä¹Ÿå±äºé˜»å¡å¼
</span>    <span class="k">print</span> <span class="n">client_data</span>

    <span class="c1"># å›å¤æ¶ˆæ¯
</span>    <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s">'æœåŠ¡ç«¯å·²æ”¶åˆ°æ¶ˆæ¯ï¼'</span><span class="p">)</span>

    <span class="c1"># å…³é—­è¿æ¥
</span>    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="socket-client-å®¢æˆ·ç«¯è„šæœ¬æ–‡ä»¶">socket client å®¢æˆ·ç«¯è„šæœ¬æ–‡ä»¶</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
# -*- coding:utf-8 -*-
</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">ip_port</span> <span class="o">=</span> <span class="p">(</span><span class="s">'127.0.0.1'</span><span class="p">,</span><span class="mi">9999</span><span class="p">)</span>

<span class="n">sk</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>

<span class="n">sk</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">ip_port</span><span class="p">)</span>

<span class="n">sk</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s">'æœåŠ¡å™¨ç«¯ï¼æˆ‘æ˜¯å®¢æˆ·ç«¯...'</span><span class="p">)</span>

<span class="n">server_reply</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

<span class="k">print</span> <span class="n">server_reply</span>
<span class="n">sk</span><span class="o">.</span><span class="n">close</span>

</code></pre></div></div>

<h2 id="python-ç®€å•-socket-é€šä¿¡æ¨¡å‹è¿‡ç¨‹æ¼”ç¤º">Python ç®€å• Socket é€šä¿¡æ¨¡å‹è¿‡ç¨‹æ¼”ç¤º</h2>

<h3 id="1-å¯åŠ¨-socket-serverå¼€å§‹ç›‘å¬-socket">1. å¯åŠ¨ Socket Serverï¼Œå¼€å§‹ç›‘å¬ Socket</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@VM_15_187_centos socket]# python socket_server.py <span class="c"># å‰å°è¿è¡Œ socket_server.py, å¼€å§‹ç›‘å¬ Socket ç«¯å£</span>
server waiting...

<span class="o">[</span>root@VM_15_187_centos socket]# netstat <span class="nt">-lntp</span> | <span class="nb">grep </span>9999 <span class="c">#  socket_server ç›‘å¬ Socket IP å’Œç«¯å£ä¸º 127.0.0.1:9999</span>
tcp        0      0 127.0.0.1:9999              0.0.0.0:<span class="k">*</span>                   LISTEN      17411/python  
</code></pre></div></div>

<h3 id="2-å¯åŠ¨-socket-clientå‘-socket-server-å‘é€æ•°æ®">2. å¯åŠ¨ Socket Clientï¼Œå‘ Socket Server å‘é€æ•°æ®</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@VM_15_187_centos socket]# python socket_client.py 
æœåŠ¡ç«¯å·²æ”¶åˆ°æ¶ˆæ¯ï¼				<span class="c"># æ­¤å¤„æ˜¯æ¥æ”¶åˆ°çš„æ¥è‡ªäºæœåŠ¡ç«¯è¿”å›çš„æ¶ˆæ¯</span>
</code></pre></div></div>

<h3 id="3-socket-server-æ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„æ•°æ®">3. Socket Server æ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„æ•°æ®</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@VM_15_187_centos socket]# python socket_server.py 
server waiting...
æœåŠ¡å™¨ç«¯ï¼æˆ‘æ˜¯å®¢æˆ·ç«¯...			<span class="c"># æ­¤å¤„æ˜¯æ¥æ”¶åˆ°çš„æ¥è‡ªäºå®¢æˆ·ç«¯å‘é€è¿‡æ¥æ¶ˆæ¯</span>

</code></pre></div></div>

<h1 id="ref">Ref</h1>
<p><a href="http://lilongzi.blog.51cto.com/5519072/1877897">è‡ªåŠ¨åŒ–è¿ç»´Pythonç³»åˆ—ï¼ˆä¸ƒï¼‰ä¹‹Socketç¼–ç¨‹</a><br />
<a href="http://yangrong.blog.51cto.com/6945369/1339593">python socketç¼–ç¨‹è¯¦ç»†ä»‹ç»</a><br />
<a href="https://docs.python.org/2/howto/sockets.html">Socket Programming HOWTO</a><br />
<a href="https://docs.python.org/2/library/socket.html">17.2. socket â€” Low-level networking interface</a></p>

:ET