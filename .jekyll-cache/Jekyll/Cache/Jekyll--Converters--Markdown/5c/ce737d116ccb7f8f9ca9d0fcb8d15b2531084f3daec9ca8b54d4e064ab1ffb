I"¸<h1 id="1-å®‰è£…-zabbix-java-gateway">1. å®‰è£… Zabbix-Java-Gateway</h1>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># é˜¿é‡Œ Zabbix yum æº</span>
rpm <span class="nt">-ivh</span> http://mirrors.aliyun.com/zabbix/zabbix/3.0/rhel/7/x86_64/zabbix-release-3.0-1.el7.noarch.rpm

<span class="c"># å®‰è£… java ç¯å¢ƒ</span>
yum <span class="nb">install </span>java
yum <span class="nb">install </span>zabbix-java-gateway

</code></pre></div></div>

<h1 id="2-é…ç½®-zabbix_java_gatewayconf">2. é…ç½® zabbix_java_gateway.conf</h1>

<p>ä¿®æ”¹é…ç½®å¦‚ä¸‹ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">[</span>root@linux-node2 ~]# egrep <span class="nt">-v</span> <span class="s1">'^#|^$'</span> /etc/zabbix/zabbix_java_gateway.conf 
<span class="nv">LISTEN_IP</span><span class="o">=</span><span class="s2">"0.0.0.0"</span>
<span class="nv">LISTEN_PORT</span><span class="o">=</span>10052
<span class="nv">PID_FILE</span><span class="o">=</span><span class="s2">"/var/run/zabbix/zabbix_java.pid"</span>
<span class="nv">START_POLLERS</span><span class="o">=</span>5
<span class="nv">TIMEOUT</span><span class="o">=</span>3

</code></pre></div></div>

<h1 id="3-é…ç½®-zabbix_serverconf">3. é…ç½® zabbix_server.conf</h1>

<p>ä¿®æ”¹é…ç½®å¦‚ä¸‹(å…³æ³¨ Java ç›¸å…³å‚æ•°)ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">[</span>root@linux-node1 ~]# egrep <span class="nt">-v</span> <span class="s1">'^#|^$'</span> /etc/zabbix/zabbix_server.conf
<span class="nv">LogFile</span><span class="o">=</span>/var/log/zabbix/zabbix_server.log
<span class="nv">LogFileSize</span><span class="o">=</span>0
<span class="nv">PidFile</span><span class="o">=</span>/var/run/zabbix/zabbix_server.pid
<span class="nv">DBHost</span><span class="o">=</span>localhost
<span class="nv">DBName</span><span class="o">=</span>zabbix
<span class="nv">DBUser</span><span class="o">=</span>zabbix
<span class="nv">DBPassword</span><span class="o">=</span>zabbix
<span class="nv">JavaGateway</span><span class="o">=</span>192.168.56.12
<span class="nv">JavaGatewayPort</span><span class="o">=</span>10052
<span class="nv">StartJavaPollers</span><span class="o">=</span>5
<span class="nv">SNMPTrapperFile</span><span class="o">=</span>/var/log/snmptrap/snmptrap.log
<span class="nv">Timeout</span><span class="o">=</span>4
<span class="nv">AlertScriptsPath</span><span class="o">=</span>/usr/lib/zabbix/alertscripts
<span class="nv">ExternalScripts</span><span class="o">=</span>/usr/lib/zabbix/externalscripts
<span class="nv">LogSlowQueries</span><span class="o">=</span>3000

</code></pre></div></div>

<h1 id="4-java-åº”ç”¨å¼€å¯-jmx-åè®®">4. Java åº”ç”¨å¼€å¯ JMX åè®®</h1>

<h2 id="41-tomcat-å¼€å¯-jmx-æ”¯æŒ">4.1 Tomcat å¼€å¯ JMX æ”¯æŒ</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># 1. å®‰è£… java ç¯å¢ƒ</span>
yum <span class="nb">install </span>java

<span class="c"># 2. å®‰è£… Tomcat</span>

<span class="nb">cd</span> /usr/local/src/
wget http://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-8/v8.0.36/bin/apache-tomcat-8.0.36.zip

unzip apache-tomcat-8.0.36.zip 
<span class="nb">mv </span>apache-tomcat-8.0.36 /usr/local/
<span class="nb">ln</span> <span class="nt">-s</span> /usr/local/apache-tomcat-8.0.36 /usr/local/apache-tomcat

<span class="c"># 3. Tomcat é…ç½® JMX æ”¯æŒ</span>

<span class="c"># ä¿®æ”¹ apache-tomcat/bin/catalina.sh</span>
<span class="c"># åœ¨ Execute The Requested Command å‰åŠ å…¥å¦‚ä¸‹ä»£ç ï¼ˆæœªé‡‡ç”¨è®¤è¯åŠ å¯†æ–¹å¼ï¼‰ï¼š</span>

<span class="nv">CATALINA_OPTS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$CATALINA_OPTS</span><span class="s2"> -Dcom.sun.management.jmxremote
  -Dcom.sun.management.jmxremote.port=10053
  -Dcom.sun.management.jmxremote.ssl=false
  -Dcom.sun.management.jmxremote.authenticate=false
  -Djava.rmi.server.hostname=192.168.56.12"</span>

<span class="c"># 4. å¯åŠ¨æˆ–é‡å¯ Tomcat</span>

<span class="nb">chmod</span> +x /usr/local/apache-tomcat/bin/<span class="k">*</span>.sh

sh /usr/local/apache-tomcat/bin/shutdown.sh
sh /usr/local/apache-tomcat/bin/startup.sh

</code></pre></div></div>

<h2 id="42-éªŒè¯-jmx-è¿æ¥">4.2 éªŒè¯ JMX è¿æ¥</h2>

<h3 id="421-åœ¨-windows-ä¸Šé€šè¿‡-jconsole-éªŒè¯">4.2.1 åœ¨ Windows ä¸Šé€šè¿‡ jconsole éªŒè¯</h3>

<p>åœ¨ Windows ç³»ç»Ÿä¸‹å®‰è£… jdk åï¼Œä½¿ç”¨ jconsole è¿æ¥ 192.168.56.12:10053ï¼Œå¼€å¯ JMX æˆåŠŸåçš„ç»“æœæˆªå›¾å¦‚ä¸‹ï¼š
<img src="https://raw.githubusercontent.com/JaminZhang/jaminzhang.github.io/master/images/JMX-jconsole-summary.png" alt="JMX-jconsole-summary" /><br />
<img src="https://raw.githubusercontent.com/JaminZhang/jaminzhang.github.io/master/images/JMX-jconsole-VM-summary.png" alt="JMX-jconsole-VM-summary" /></p>

<h3 id="422-åœ¨-zabbix-serverä¸Šé€šè¿‡-cmdline-jmxclient-éªŒè¯">4.2.2 åœ¨ Zabbix Serverä¸Šé€šè¿‡ cmdline-jmxclient éªŒè¯</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">[</span>root@linux-node1 ~]# java <span class="nt">-jar</span> cmdline-jmxclient-0.10.3.jar - 192.168.56.12:10053 java.lang:type<span class="o">=</span>Memory NonHeapMemoryUsage
06/20/2016 12:05:20 +0800 org.archive.jmx.Client NonHeapMemoryUsage: 
committed: 30015488
init: 2555904
max: <span class="nt">-1</span>
used: 28761904

</code></pre></div></div>

<h1 id="5-zabbix-web-ç•Œé¢é…ç½®-jmx-ç›‘æ§-java-åº”ç”¨">5. Zabbix Web ç•Œé¢é…ç½® JMX ç›‘æ§ Java åº”ç”¨</h1>

<p>è¿™é‡Œæˆ‘ç›´æ¥å…³è” Zabbix è‡ªå¸¦çš„ JMX é€šç”¨æ¨¡æ¿ï¼ˆé»˜è®¤ä¼šæœ‰äº› Key æ˜¾ç¤º â€œNot supportedâ€ï¼‰ï¼Œ<br />
è¿™éœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹é…ç½®ï¼Œè·å–æ•°æ®åç”Ÿæˆçš„ Graph å¦‚ä¸‹æ‰€ç¤º
<img src="https://raw.githubusercontent.com/JaminZhang/jaminzhang.github.io/master/images/JMX-Zabbix-Template-Items.png" alt="JMX-Zabbix-Template-Items" /></p>

<p>å½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±æ·»åŠ ç›¸åº”çš„ JMX key å’Œ item</p>

<h1 id="é…ç½®è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜">é…ç½®è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜</h1>

<h2 id="1-yum-å®‰è£…çš„-tomcat-æ‰¾ä¸åˆ°-catalinash">1. yum å®‰è£…çš„ tomcat æ‰¾ä¸åˆ° catalina.sh</h2>

<p>åœ¨ <code class="highlighter-rouge">/usr/sbin/tomcat</code> æ–‡ä»¶å¼€å¤´æ·»åŠ  <code class="highlighter-rouge">CATALINA_OPTS</code> JMX ç›¸å…³å‚æ•°æ—¶å¹¶ä¸ç”Ÿæ•ˆï¼Œ<br />
è§£å†³æ–¹æ³•ï¼šæ¢æˆä»å®˜ç½‘ä¸‹è½½ Apache Tomcat 8.0.36 è½¯ä»¶åŒ…ä½¿ç”¨ã€‚</p>

<h2 id="2-windows-10-jdk-180_91-æ²¡æœ‰-jconsole">2. Windows 10 jdk 1.8.0_91 æ²¡æœ‰ jconsole</h2>

<p>åœ¨éªŒè¯ JMX è¿æ¥æ—¶ï¼Œéœ€è¦ä½¿ç”¨ jconsoleï¼Œä½†æˆ‘åœ¨ Windows 10 ç³»ç»Ÿä¸‹å®‰è£… jdk 1.8.0_91 åï¼Œç«Ÿç„¶æ²¡æœ‰ jconsoleï¼Ÿ 
Windows 7 ç³»ç»Ÿä¸‹å®‰è£…æ˜¯æœ‰ jconsoleã€‚Windows 10 ä¸‹å®‰è£… jdk 1.7 åæœ‰ jconsoleã€‚</p>

<h1 id="ref">Ref</h1>
<p><a href="http://wangzan18.blog.51cto.com/8021085/1692444">Zabbix ä¹‹é€šè¿‡ JMX ç›‘æ§ Tomcat</a> Â 
<a href="http://caisangzi.blog.51cto.com/6387416/1301682">Zabbix ç›‘æ§ä¹‹ JMX åè®®</a><br />
<a href="http://tomcat.apache.org/tomcat-8.0-doc/monitoring.html#Enabling_JMX_Remote">Enabling JMX Remote</a><br />
<a href="http://it.nfsq.com.cn/index.php/2016/04/17/linux-tomcat8-jmx-monitor/">Linux Tomcat 8 é…ç½® JMX ç›‘æ§</a></p>

:ET